function init(){function e(){var e={},t=["R_Temporal_Lobe","R_Parietal_Lobe","R_Occipital_Lobe","R_Frontal_Lobe"];t.forEach(function(r,n){e[t[n]]=new THREE.OBJLoader,e[t[n]].load("../obj/Right cortex sulci and gyri/"+r+".obj",function(e,t){e.name=r,objects.push(e),e.traverse(function(e){e instanceof THREE.Mesh&&(e.geometry.applyMatrix((new THREE.Matrix4).makeTranslation(0,0,250)),e.geometry.verticesNeedUpdate=!0,e.geometry.computeFaceNormals(),e.geometry.computeVertexNormals(),e.material=new THREE.MeshLambertMaterial({color:15252568,side:THREE.DoubleSide}))}),scene.add(e)})})}function t(){var t={},r=["L_Temporal_Lobe","L_Parietal_Lobe","L_Occipital_Lobe","L_Frontal_Lobe","L_frontal_inferior_triangularis-Brocas","L_cingulate_midposterior-Wernickes"];r.forEach(function(n,a){t[r[a]]=new THREE.OBJLoader,t[r[a]].load("../obj/Left cortex sulci and gyri/"+n+".obj",function(e){e.name=n,objects.push(e),e.traverse(function(e){e instanceof THREE.Mesh&&(e.geometry.applyMatrix((new THREE.Matrix4).makeTranslation(0,0,250)),e.geometry.verticesNeedUpdate=!0,e.geometry.computeFaceNormals(),e.geometry.computeVertexNormals(),e.material=new THREE.MeshLambertMaterial({color:15252568,side:THREE.DoubleSide}),e.material.transparency=!0)}),scene.add(e)}),a==r.length-1&&e()})}container=document.createElement("div"),document.body.appendChild(container),scene=new THREE.Scene,viewSize=1e3,aspectRatio=window.innerWidth/window.innerHeight,camera=new THREE.OrthographicCamera(-aspectRatio*viewSize/2,aspectRatio*viewSize/2,viewSize/2,-viewSize/2,-1e4,1e6),camera.position.set(0,0,1),scene.add(camera);var r=new THREE.DirectionalLight(15251533,1);r.position.set(0,0,1e3),camera.add(r);var n={},a=["white_matter","L-Cerebellum-Cortex","R-Cerebellum-Cortex","Cerebellum-White-Matter","Cerebellum-Vermis","Caudate_nucleus","corpus_callosum","fornix","globus_pallidus","hippocampus","hypothalamus","third_Ventricle","fourth_Ventricle","lateral_ventricles_FH","lateral_ventricles_OH","lateral_ventricles_SE","lateral_ventricles_TH","putamen","thalamus"];a.forEach(function(e,r){n[a[r]]=new THREE.OBJLoader,n[a[r]].load("../obj/"+e+".obj",function(t){t.name=e,objects.push(t),t.traverse(function(e){e instanceof THREE.Mesh&&(e.geometry.applyMatrix((new THREE.Matrix4).makeTranslation(0,0,250)),e.geometry.verticesNeedUpdate=!0,e.geometry.computeFaceNormals(),e.geometry.computeVertexNormals(),e.material=new THREE.MeshLambertMaterial({color:14067258,side:THREE.DoubleSide}),e.material.transparent=!0)}),scene.add(t)}),r==a.length-1&&t()}),controls=new THREE.TrackballControls(camera),controls.rotateSpeed=1,controls.zoomSpeed=.5,controls.panSpeed=.8,controls.addEventListener("change",render),renderer=new THREE.WebGLRenderer,renderer.setClearColor(0),renderer.setSize(window.innerWidth,window.innerHeight),container.appendChild(renderer.domElement),container.addEventListener("mousewheel",onDocumentMouseWheel,!1),container.addEventListener("DOMMouseScroll",onDocumentMouseWheel,!1),container.addEventListener("mousedown",onDocumentMouseDown,!1),container.addEventListener("mouseup",onDocumentMouseUp,!1),window.addEventListener("resize",onWindowResize,!1)}function onDocumentMouseDown(e){storeData=setInterval(storeMovements,1e3)}function onDocumentMouseUp(e){clearInterval(storeData)}function storeMovements(){$.ajax({type:"POST",url:"handler.php",data:{event_data:camera.matrix.elements,event_type:"rotation"},error:function(){console.log("Request timeout")},timeout:1e3})}function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight),controls.handleResize(),render()}function onDocumentMouseWheel(e){var t=.02;e.preventDefault(),e.stopPropagation();var r=0;e.wheelDelta?r=e.wheelDelta/40:e.detail&&(r=-e.detail/3);var n=camera.right/t,a=camera.top/t;t-=.001*r,camera.left=-t*n,camera.right=t*n,camera.top=t*a,camera.bottom=-t*a,camera.updateProjectionMatrix(),renderer.render(scene,camera)}function animate(){requestAnimationFrame(animate),controls.update(),render()}function render(){renderer.render(scene,camera)}function onChange(e){if("function"!=typeof Event&&document.fireEvent)e.fireEvent("onchange");else{var t=document.createEvent("HTMLEvents");t.initEvent("change",!0,!0),e.dispatchEvent(t)}}function brain_opacity(e){brain_children=scene.children,brain_children.forEach(function(t){t.traverse(function(t){t instanceof THREE.Mesh&&(t.material.transparent=!0,t.material.opacity=e),t.updateMatrixWorld()})})}var container,camera,controls,scene,renderer,intersected,state,raycaster=new THREE.Raycaster,mouse=new THREE.Vector2,brain=new THREE.Object3D,objects=[];init(),animate();var controlName={},sideControls=["fourth_Ventricle","third_Ventricle","lateral_ventricles_FH","lateral_ventricles_OH","lateral_ventricles_SE","lateral_ventricles_TH","corpus_callosum","hypothalamus","hippocampus","fornix","thalamus","globus_pallidus","Caudate_nucleus","putamen","white_matter","L_Temporal_Lobe","L_Parietal_Lobe","L_Occipital_Lobe","L_Frontal_Lobe","L_frontal_inferior_triangularis-Brocas","L_cingulate_midposterior-Wernickes","R_Temporal_Lobe","R_Parietal_Lobe","R_Occipital_Lobe","R_Frontal_Lobe","L-Cerebellum-Cortex","R-Cerebellum-Cortex","Cerebellum-White-Matter","Cerebellum-Vermis"];sideControls.forEach(function(e,t){controlName[sideControls[t]]=document.querySelector("."+e);new Switchery(controlName[sideControls[t]],{size:"small"});controlName[sideControls[t]].onchange=function(){var r=scene.getObjectByName(e,!0);state=controlName[sideControls[t]].checked?"enabled":"disabled",$.ajax({type:"POST",url:"handler.php",data:{event_data:e,event_type:state},error:function(){console.log("Request timeout")},timeout:1e3}),r.traverse(function(e){e instanceof THREE.Mesh&&(controlName[sideControls[t]].checked?(e.visible=!0,objects.push(r)):(e.visible=!1,objects.splice(objects.indexOf(r),1)))})}});var primary_controls=Array.prototype.slice.call(document.querySelectorAll(".primary"));primary_controls.forEach(function(e){new Switchery(e,{size:"small"});e.onchange=function(t){var r=jQuery(e).parent().next().attr("id"),n=Array.prototype.slice.call(document.querySelectorAll("#"+r+" input"));n.forEach(function(t,r){var n=jQuery(t).attr("class"),a=scene.getObjectByName(n,!0);e.checked?(t.checked=!0,"primary"!=n&&a.traverse(function(e){e instanceof THREE.Mesh&&(e.visible=!0)}),onChange(t)):(t.checked=!1,"primary"!=n&&a.traverse(function(e){e instanceof THREE.Mesh&&(e.visible=!1)}),onChange(t))})}}),jQuery(document).ready(function(e){jQuery("#control_sidebar,#control_sidebar ul li.secondary").accordion({heightStyle:"content",collapsible:!0,active:!1}),jQuery("#control_sidebar li span:first-child").mousedown(function(t){jQuery("#control_sidebar li span.title").attr("style","");var r=Array.prototype.slice.call(document.querySelectorAll("#control_sidebar input"));if(r.forEach(function(e,t){var r=jQuery(e).attr("class");if("primary"!=r){brain_opacity(1);var n=scene.getObjectByName(r,!0);n.traverse(function(e){e instanceof THREE.Mesh&&e.material.emissive.setHex(e.currentHex)})}}),1==t.which){jQuery(this).css("color","red");var n=jQuery(this).parent().find("input").attr("class");if(e.ajax({type:"POST",url:"handler.php",data:{event_data:n,event_type:"Section Select/Left Click"},error:function(){console.log("Request timeout")},timeout:1e3}),e.ajax({type:"POST",url:"descriptions.php",data:{file_name:n},success:function(e){e=e.replace(/(?:\r\n|\r|\n)/g,"<br />"),document.querySelector("#info_box").innerHTML=e}}),"primary"!=n){brain_opacity(.1);var a=scene.getObjectByName(n,!0);a.traverse(function(e){e instanceof THREE.Mesh&&(e.material.opacity=1,e.currentHex=e.material.emissive.getHex(),e.material.emissive.setHex(16711680)),e.updateMatrixWorld()})}}}),jQuery(document).mouseup(function(t){if(3==t.which){e.ajax({type:"POST",url:"handler.php",data:{event_data:null,event_type:"Section Deselect/Right Click"},error:function(){console.log("Request timeout")},timeout:1e3}),jQuery("#control_sidebar li span.title").attr("style",""),document.querySelector("#info_box").innerHTML="";var r=Array.prototype.slice.call(document.querySelectorAll("#control_sidebar input"));r.forEach(function(e,t){var r=jQuery(e).attr("class");if("primary"!=r){brain_opacity(1);var n=scene.getObjectByName(r,!0);n.traverse(function(e){e instanceof THREE.Mesh&&e.material.emissive.setHex(e.currentHex)})}})}})});